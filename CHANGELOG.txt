CHANGELOG

### v3.0.3 - Refresh Button (Feb 2, 2026)

#### Features
- **Reload button:** Added refresh button (↻) next to theme toggle for reloading the app
- Shows confirmation modal if chat session exists to prevent accidental data loss

#### Files Changed
- `templates/index.html` - Added refresh button element
- `static/style.css` - Added button positioning and hover styles
- `static/script.js` - Added click handler with confirmation logic

### v3.0.2 - Windows Build Fix (Feb 2, 2026)

#### Fixes
- **pythonnet compatibility:** Windows build requires Python 3.12 (pythonnet lacks pre-built wheels for Python 3.14)
- **ASCII art asset:** Added `ascii.txt` with yourSQLfriend logo for welcome screen display

#### Notes
- Windows users must use Python 3.10-3.12 to build (pythonnet dependency)
- Linux builds work with any Python 3.10+

### v3.0.1 - PyInstaller Build Fixes (Feb 2, 2026)

#### Fixes
- **numpy bundling:** Removed numpy from PyInstaller excludes list (pandas requires it)
- **PyGObject bundling:** Added `--system-site-packages` to venv creation so PyInstaller can access system-installed `gi` module for GTK/WebKit rendering

#### Files Changed
- `yourSQLfriend.spec` - Removed numpy from excludes
- `build_linux.sh` - Use `--system-site-packages` when creating venv

### v3.0 - Desktop App Packaging with PyInstaller + pywebview (Feb 2, 2026)

#### New Features
- **Standalone Desktop App:** yourSQLfriend now runs as a native desktop application with no browser required. Uses pywebview for native window rendering.
- **Single-File Executables:** Build distributable binaries for Windows (.exe) and Linux with PyInstaller.
- **Version Display:** App version now shown in sidebar footer and fetched via new `/api/version` endpoint.
- **LLM Connection Guidance:** When LLM is offline, sidebar now shows helpful setup instructions (commands for Ollama/LM Studio).

#### New Files
- `main.py` - Desktop entry point using pywebview with 1400x900 window (min 1024x700)
- `yourSQLfriend.spec` - PyInstaller configuration bundling templates, static, assets, and ascii.txt
- `build_linux.sh` - Linux build script (creates venv, installs deps, runs PyInstaller)
- `build_windows.bat` - Windows build script (same workflow)

#### Architecture Changes
- **User Data Directory:** All runtime data (uploads, logs, sessions) now stored in `~/.yourSQLfriend/` (Linux/macOS) or `%APPDATA%\.yourSQLfriend\` (Windows) instead of project directory.
- **Frozen Detection:** Added `get_base_path()` to resolve bundled resources when running as compiled executable.
- **Path Abstraction:** Added `get_data_dir()` for cross-platform user data storage.

#### Code Changes
- `app.py`: Added `VERSION = "3.0.0"` constant, `get_base_path()`, `get_data_dir()`, `/api/version` endpoint
- `app.py`: Updated `UPLOAD_FOLDER`, `LOG_DIR`, `SESSION_FILE_DIR` to use `DATA_DIR`
- `app.py`: Updated template/static paths and CSS path resolution for PyInstaller compatibility
- `app.py`: Export report footer now uses `VERSION` constant instead of hardcoded version
- `templates/index.html`: Added version display element in sidebar
- `static/script.js`: Added version fetching on load, LLM guidance panel when offline
- `static/style.css`: Added `.sidebar-version` and `.llm-guidance` styling
- `requirements.txt`: Added `pywebview>=5.0`

#### Documentation
- `README.md`: Complete restructure with Quick Start for desktop users, Linux WebKitGTK requirements table, Building from Source section, Data Storage documentation

#### Platform Requirements
- **Windows:** No additional dependencies (uses EdgeChromium/WinForms)
- **Linux:** Requires WebKitGTK (`gir1.2-webkit2-4.1` on Ubuntu/Debian, `webkit2gtk4.1` on Fedora, `webkit2gtk-4.1` on Arch)

### v2.9 - ASCII Art Fix & Bloat Removal (Feb 1, 2026)

#### Fixes
- **ASCII Art Rendering:** Fixed garbled ASCII logo display by loading art from `ascii.txt` file instead of hardcoded HTML. Preserves exact spacing and alignment.
- **Venv Path Fix:** Updated virtual environment activate script paths after project rebrand from `mysqlhelper` to `yourSQLfriend`.
- **Version Sync:** Updated all version references to v2.9 (templates, export footer).

#### Removed
- Deleted legacy `checkOllamaStatus()` function from script.js (unused backward-compat wrapper)
- Deleted legacy `updateOllamaStatusUI()` function from script.js (unused backward-compat wrapper)
- Deleted orphaned `.db-status-chip` CSS rule from style.css (feature removed in v2.8)
- Removed `SQLAlchemy` from requirements.txt (never imported - project uses raw sqlite3)

### v2.7 - UX/UI Polish & Improvements (Feb 1, 2026)

#### UX Improvements
- **Database Loading State:** Added status chip above chat input showing "No database loaded" vs filename. Chat input disabled until database loaded.
- **Unified LLM Status:** Both LM Studio and Ollama now show connection status on page load (was Ollama only). Health check runs every 30 seconds.
- **Better Onboarding:** Added file type hints (.db .sqlite .csv .sql) below drop zone. Added example queries on welcome screen.
- **Collapsible Schema:** Tables are now collapsible (click to expand/collapse columns). Shows table count badge and column count per table.
- **Upload Progress:** Shows spinner on drop zone during file upload with "Uploading filename..." text.

#### UI Polish
- **Light Theme Contrast:** Darkened `--primary` (#d08010 → #b06800) and `--foreground-muted` (#8a8a9a → #5a5a6a) for WCAG AA compliance.
- **CSS Cleanup:** Moved inline styles from note editor JS to CSS classes. Enables proper theme support for notes.
- **Animation Optimization:** Sidebar now uses GPU-accelerated `transform: translateX()` instead of `margin-left`.
- **Tablet Breakpoint:** Added 1024px breakpoint with adjusted sidebar width (260px) for better tablet experience.
- **Token Counter Layout:** Changed from absolute positioning to `float: right` for consistent layout across messages.

### v2.6 - UI/UX Fixes & SQL Validation Improvements (Feb 1, 2026)

#### UI Fixes
- **Scrollbar Visibility:** Changed default scrollbar color from dark gray to orange theme color (`--primary-dark`). Hover state now shows brighter orange (`--primary`).
- **Firefox Scrollbar Support:** Added `scrollbar-color` property for Firefox compatibility.
- **Table Column Alignment:** Fixed sticky header desync during horizontal scroll. Reduced `min-width` from 120px to 80px, added `max-width: 400px` with text truncation.
- **Header z-index:** Increased from 1 to 10 to prevent overlap issues.

#### Grid.js Changes
- Disabled column resizing (was causing alignment issues).
- Enabled `fixedHeader` for better scroll behavior.
- Added `thead` sticky positioning for full-row header fix.

#### SQL Validation
- **Smarter Multi-Statement Detection:** Added `strip_strings_and_comments()` helper that removes string literals and comments before checking for multiple statements.
- **False Positive Fixes:** Queries with semicolons inside strings (`SELECT 'a;b'`) or trailing comments (`SELECT * FROM t; -- note`) now pass validation.
- **Security Preserved:** Actual multi-statement attacks still blocked; forbidden keywords check unchanged.

### v2.5 - Ollama Integration & Security Hardening (Feb 1, 2026)

#### Features
- **Dual LLM Provider Support:** Switch between LM Studio and Ollama via dropdown in sidebar.
- **Ollama Status Indicator:** Green/red dot shows connection status with pulse animation when connected.
- **Dynamic Model Selection:** Dropdown auto-populates with available Ollama models from `/api/tags`.
- **30-Second Polling:** Automatic status checks when Ollama provider is selected.
- **Provider-Specific Errors:** Helpful troubleshooting messages for each LLM backend.

#### Security Fixes
- **XSS Prevention (Export):** Escaped `original_filename` and `hostname` in HTML exports using `html.escape()`.
- **XSS Prevention (Search):** Escaped table names, column names, and values in Search All Tables results.
- **Request Validation:** All POST endpoints now validate `request.json` is not None before accessing.
- **Error Message Escaping:** Search error messages now escaped to prevent injection.

#### New Endpoints
- `GET /api/ollama/status` - Check Ollama availability and list models
- `POST /api/ollama/model` - Set active Ollama model for session
- `GET /api/provider/status` - Unified provider status check

#### Environment Variables
- `LLM_PROVIDER` - Default provider: `lmstudio` or `ollama`
- `OLLAMA_URL` - Ollama endpoint (default: `http://localhost:11434`)
- `OLLAMA_MODEL` - Default Ollama model (default: `llama3.2`)

### v2.4 - UI/UX Polish (Jan 31, 2026)
- Custom confirmation/alert modals with accessibility improvements
- Hover effects and transitions throughout UI
- Improved focus management in modals

### v2.3 - Bloat Removal (Jan 14, 2026)

#### Removed
- Deleted unused `import csv` from app.py (pandas handles CSV)
- Deleted dead `updateAllTokenCounters()` function from script.js (never called)
- Deleted unused `displayedCount` variable from script.js
- Deleted `mermaid.min.css` library file (never used)
- Deleted `asciiart.txt` (redundant - art hardcoded in index.html)
- Deleted `GEMINI.md` (alternative AI instructions - unused)
- Deleted `initial-prompt.md` (historical artifact)

### v2.2 - Digital Forensics Terminal Theme
- **UI Overhaul:** Complete visual redesign with "Digital Forensics Terminal" aesthetic.
- **Typography:** Replaced generic Inter/Roboto with JetBrains Mono + IBM Plex Sans via Google Fonts.
- **Colors:** New amber (#f0a030) primary + cyan (#40d0d0) accent palette, deeper blacks.
- **Effects:** Subtle scan-line overlay, glow effects on buttons/inputs, animated ASCII logo gradient.
- **Animations:** Chat messages slide-in, modal backdrop blur, smooth hover transitions.
- **UX:** Simplified file upload - auto-uploads on file selection (removed "Upload & Load" button).
- **Export:** Compact forensic report header with inline layout and truncated hash (full on hover).

### v2.1 - Final Polish & Cleanup
- **Removed:** CSV Export button (redundant - use Copy button on SQL blocks instead).
- **Removed:** Regex filter toolbar (redundant - Grid.js built-in search already filters all columns).
- **Fix:** Resolved pagination visibility issue in query results.
- **Fix:** Resolved double horizontal scrollbar issue when resizing browser.
- **UX:** Simplified results display with row count label and Grid.js native search.
- **Docs:** Updated version references across all files.

### v2.0 - Forensic Toolkit & UI Enhancements
- **Feature:** Added **Dark/Light Theme Toggle** with localStorage persistence. Click the moon/sun icon to switch themes.
- **Feature:** Added **Multi-Column Sorting** - hold Shift while clicking column headers to sort by multiple columns.
- **Feature:** Added **Search All Tables** - full-text search across all database tables with case sensitivity toggle and compact grouped output.
- **Feature:** Added **12 Custom SQL Functions** for forensic analysis:
  - Timestamp converters: `unix_to_datetime()`, `webkit_to_datetime()`, `ios_to_datetime()`, `filetime_to_datetime()`
  - Encode/decode: `encode_base64()`, `decode_base64()`, `to_hex()`, `decode_hex()`
  - Pattern extractors: `extract_email()`, `extract_ip()`, `extract_url()`, `extract_phone()`
- **Feature:** Added **Browser Warning** when leaving page with active chat session to prevent accidental data loss.
- **UX:** Grid.js tables now respect theme colors (dark/light mode aware).
- **Security:** SQL validation now allows queries with leading comments (-- style).
- **AI:** Updated LLM system prompt to document custom SQL functions and guide proper UNION ALL usage.
- **Note:** CSV Export and Regex Filter features were added and later removed in v2.1 as redundant.

### v1.7 - SQL Capabilities Expansion & Defense-in-Depth Security
- **Feature:** SQL validation now supports **CTEs (WITH clauses)** for complex analytical queries.
- **Feature:** Added support for **EXPLAIN** and **EXPLAIN QUERY PLAN** for query performance analysis.
- **Feature:** Added support for read-only **PRAGMA** commands (table_info, foreign_key_list, integrity_check, etc.) for schema inspection.
- **Security:** Implemented **database-level read-only enforcement** - connections now opened in SQLite `mode=ro` with `PRAGMA query_only = ON` for defense-in-depth protection.
- **Security:** Expanded SQL keyword blocklist from 9 to 13 keywords, added PRAGMA-specific safety checks.
- **AI/UX:** Fixed LLM system prompt to execute simple queries immediately instead of asking for confirmation on unambiguous requests.
- **AI/UX:** Improved clarity in prompt - LLM now only asks clarifying questions for genuinely ambiguous requests.
- **Testing:** Added comprehensive validation test suite (15 test cases) covering safe query patterns and security blocking.

### v1.6 - Interactive Tables, Annotations & Shortcuts
- **Feature:** Added **Smart Data Tables** (via Grid.js) for SQL results, featuring sortable columns, search/filter, and pagination.
- **Feature:** Added **Forensic Annotations** allowing analysts to attach persistent notes to any assistant response. Notes are preserved in chat exports.
- **UX:** Implemented **Syntax Highlighting** for SQL code blocks in chat responses.
- **UX:** Significant UI polish including dark-themed interactive elements and improved visibility for inputs/pagination.
- **Tech:** Replaced simple HTML tables with interactive Grid.js components.
- **Tech:** Added `uuid` based message tracking to support persistent annotations.

### v1.5 - UI/UX Overhaul & Drag-and-Drop
- **Feature:** Implemented a dedicated drag-and-drop zone for database uploads, replacing the basic file input.
- **UX:** Added a persistent, minimized welcome screen that stays at the top of the chat history for better branding and visual continuity.
- **UX:** Fixed the "empty message bubble" glitch that appeared after file uploads.
- **Visuals:** Refined the welcome screen transition animations and solved ASCII art clipping issues in the minimized state.

### v1.4 - Forensic Hardening & Security
- **Feature:** Added SHA256 hashing for all uploaded evidence files.
- **Feature:** Implemented comprehensive audit logging (`logs/`) with daily rotation.
- **Feature:** Enhanced "Export Chat" with professional forensic report header (Hash, timestamps, analyst info).
- **Feature:** Added support for importing `.csv` (auto-converted to SQLite) and `.sql` dump files.
- **AI Persona:** Refined LLM system prompt to act as a "Forensics Assistant" with Chain-of-Thought reasoning.
- **AI Stability:** Fixed context drift by pinning schema to system prompt.
- **Robustness:** Added backend timeouts (60s) and frontend watchdog (15s) to prevent "infinite spinner" hangs.
- **Security:** Added strict file validation (extension, magic bytes, size limits).
- **Security:** Implemented global error handling for 404/500 events.
- **UX:** Added client-side file size warnings (>100MB) and blocking (>1GB).
- **UX:** Added smart troubleshooting guide for LLM connection failures.

### v1.2 - Token Usage Tracking
- **Feature:** Display token usage in top-right of LLM chat bubbles showing per-message and cumulative totals.
- **Details:** Hover over token counter to see prompt/completion breakdown.
- **Backend:** Captures token usage from LM Studio API (v0.3.18+) via stream_options parameter.
- **Session:** Token data persists in session and is included in HTML exports.
- **Compatibility:** Graceful degradation for older LM Studio versions - no errors if token data unavailable.

### v1.1 - UI/UX Polish & Robustness
- **UI:** Fixed "double scrollbar" issues and optimized layout for windowed modes.
- **Safety:** Added confirmation dialogs when uploading a new database during an active chat.
- **Export:** Enhanced chat export to perfectly mirror the application's visual style and layout.
- **Fix:** Resolved event listener conflicts preventing double-submission on upload.
